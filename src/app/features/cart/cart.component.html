<div class="cart-page">
  <!-- Estado de Carga -->
  <div class="loading-state" *ngIf="loading">
    <div class="loader"></div>
    <p>Cargando tu carrito...</p>
  </div>

  <!-- Estado de Error -->
  <div class="error-state" *ngIf="error">
    <div class="error-content">
      <svg class="error-icon" viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
      <h2>{{ error }}</h2>
      <button class="retry-btn" (click)="loadCart()">Intentar de nuevo</button>
    </div>
  </div>

  <!-- Carrito Vacío -->
  <div class="empty-cart-state" *ngIf="!loading && !error && (!cart || cart.cartItems.length === 0)">
    <div class="empty-cart-content">
      <svg class="empty-cart-icon" viewBox="0 0 24 24">
        <path d="M15.55 13c.75 0 1.41-.41 1.75-1.03l3.58-6.49A.996.996 0 0020.01 4H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
      </svg>
      <h2>Tu carrito está vacío</h2>
      <p>Parece que aún no has agregado productos a tu carrito.</p>
      <button class="shop-now-btn" routerLink="/products">
        Ir a comprar
      </button>
    </div>
  </div>

  <!-- Contenido del Carrito -->
  <div class="cart-content" *ngIf="!loading && !error && cart && cart.cartItems.length > 0">
    <div class="cart-header">
      <h1>Carrito de Compras ({{ cart.totalItem }} productos)</h1>
    </div>

    <div class="cart-grid">
      <!-- Productos en el Carrito -->
      <div class="cart-items">
        <div class="cart-item" *ngFor="let item of cart.cartItems">
          <div class="item-image">
            <img [src]="item.sku.product.imageUrl" [alt]="item.sku.product.title">
          </div>

          <div class="item-details">
            <div class="item-header">
              <h3>{{ item.sku.product.title }}</h3>
              <div class="brand-color">
                <span class="brand">{{ item.sku.product.brand }}</span>
                <span class="color">{{ item.sku.color }}</span>
              </div>
              <span class="size">Talla: {{ item.sku.size }}</span>
            </div>

            <div class="item-pricing">
              <div class="price-block">
                <span class="current-price">S/{{ item.discountedPrice }}</span>
                <span class="original-price">S/{{ item.price }}</span>
                <span class="discount">
                  {{ getDiscountPercentage(item.price, item.discountedPrice) }}% DCTO
                </span>
              </div>

              <div class="quantity-controls">
                <button 
                  (click)="updateQuantity(item, -1)"
                  [disabled]="item.quantity === 1 || isQuantUpdated">
                  −
                </button>
                <span>{{ item.quantity }}</span>
                <button 
                  (click)="updateQuantity(item, 1)"
                  [disabled]="item.quantity === 10 || isQuantUpdated">
                  +
                </button>
              </div>
            </div>

            <button class="remove-btn" (click)="removeItem(item.id)">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
              Quitar
            </button>
          </div>
        </div>
      </div>

      <!-- Resumen del Pedido -->
      <div class="cart-summary">
        <h2>Resumen del Pedido</h2>

        <div class="summary-details">
          <div class="summary-row">
            <span>Total de Productos</span>
            <span>{{ cart.totalItem }}</span>
          </div>
          <div class="summary-row">
            <span>Precio Total</span>
            <span>S/{{ cart.totalPrice }}</span>
          </div>
          <div class="summary-row discount">
            <span>Descuento</span>
            <span>-S/{{ cart.discount }}</span>
          </div>
          <div class="summary-row total">
            <span>Total Final</span>
            <span>S/{{ cart.totalDiscountedPrice }}</span>
          </div>
        </div>

        <button class="checkout-btn" (click)="proceedToCheckout()">
          Ir al Checkout
        </button>

        <button class="continue-shopping" routerLink="/products">
          Seguir comprando
        </button>

        <button class="clear-cart-btn" (click)="clearCart()" *ngIf="cart?.cartItems?.length">
          Vaciar carrito
        </button>
      </div>
    </div>
  </div>
</div>